<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Appendix-1 AWS IoT Core Configuration - Hybrid Cloud IoT App</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Appendix-1 AWS IoT Core Configuration";
    var mkdocs_page_input_path = "AWS_IoT.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Hybrid Cloud IoT App</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Lab Access</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../LAB_access/">Accessing the Lab Environment</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cisco Container Platform (CCP)</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../ccp_exploring/">Explore Cisco Container Platform (CCP)</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_create_cluster/">Create Kubernetes Cluster on CCP (Tenant Cluster)</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_accessing_kubernetes_cluster/">Access Kubernetes Cluster (Tenant Cluster)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Hybrid Cloud IoT Application</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../deploy_backend/">Deploy Backend App on Kubernetes Cluster (Tenant Cluster)</a>
                </li>
                <li class="">
                    
    <a class="" href="../backend_exercise/">Explore Backend Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../deploy_frontend/">Deploy Frontend App on Google Kubernetes Engine (GKE)</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_grafana_kibana/">Explore Grafana and Kibana Modules on CCP</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_modify_numer_of_nodes/">Kubernetes Exercise</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Kubernetes Network Policies</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../security_policies/">Apply Security Policy to REST API Agent</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Appendices (Optional - Read Only)</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../RaPi_with_Sensor/">Appendix-2 Sensor Setup on Raspberry Pi</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Appendix-1 AWS IoT Core Configuration</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#appendix-1-aws-iot-platform-configuration">Appendix - 1: AWS IoT Platform Configuration</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#1-what-is-aws-iot-platform">1. What is AWS IoT Platform?</a></li>
        
            <li><a class="toctree-l4" href="#2-what-config-do-we-need-for-this-lab">2. What Config Do We Need for this Lab?</a></li>
        
            <li><a class="toctree-l4" href="#3-prerequisites">3. Prerequisites:</a></li>
        
            <li><a class="toctree-l4" href="#4-create-new-mqtt-policies">4. Create new MQTT Policies:</a></li>
        
            <li><a class="toctree-l4" href="#5-create-and-download-new-certificate">5. Create and Download new Certificate:</a></li>
        
            <li><a class="toctree-l4" href="#6-activate-the-certificate">6. Activate the Certificate:</a></li>
        
            <li><a class="toctree-l4" href="#7-associate-the-policies-with-certificate">7. Associate the Policies with Certificate:</a></li>
        
            <li><a class="toctree-l4" href="#8-locate-custom-endpoint">8. Locate Custom Endpoint:</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Hybrid Cloud IoT App</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Appendices (Optional - Read Only) &raquo;</li>
        
      
    
    <li>Appendix-1 AWS IoT Core Configuration</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="appendix-1-aws-iot-platform-configuration">Appendix - 1: AWS IoT Platform Configuration</h1>
<h2 id="1-what-is-aws-iot-platform">1. What is AWS IoT Platform?</h2>
<p>AWS IoT provides broad and deep functionality, spanning the edge to the cloud, so you can build IoT solutions for virtually any use case across a wide range of devices. Since AWS IoT integrates with AI services, you can make devices smarter, even without Internet connectivity. Built on the AWS cloud, used by millions of customers in 190 countries, AWS IoT can easily scale as your device fleet grows and your business requirements evolve. AWS IoT also offers the most comprehensive security features so you can create preventative security policies and respond immediately to potential security issues.</p>
<h2 id="2-what-config-do-we-need-for-this-lab">2. What Config Do We Need for this Lab?</h2>
<p>For this lab we are going to use the MQTT Broker service from AWS IoT Core, which would be used by the IoT Sensor devices (Raspberry Pi with DHT22 sensor in our case) to publish the sensor data.</p>
<p>As the direct MQTT access is not permitted by AWS, we would have to create certificate and policies to allow our sensor devices to publish the sensor data on MQTT Broker. This article would explain the process for the same.</p>
<h2 id="3-prerequisites">3. Prerequisites:</h2>
<p>You need to have a valid <strong>AWS Account</strong> with Administrative access to AWS IoT Core.</p>
<h2 id="4-create-new-mqtt-policies">4. Create new MQTT Policies:</h2>
<p>Login to <strong>AWS console</strong> and open <strong>AWS IoT Core</strong> page.</p>
<h3 id="41-create-new-policies">4.1 Create New Policies:</h3>
<p>Click on the "<strong>Create</strong>" button on "<strong>Secure --&gt; Policies</strong>" page to create a new policy as shown in the following screenshot -</p>
<p><strong>Note:</strong> If you are creating a Policy for the first time, you may see a different screen with "<strong>Create a policy</strong>" button. Just click on that button and follow other steps.</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/new_policy.png" /></p>
<h3 id="42-create-mqtt_connect-policy">4.2 Create MQTT_Connect Policy:</h3>
<p>Create a new MQTT_Connect policity with "<strong>iot:Connect</strong>" action, "<strong>*</strong>" Resource ARN and "<strong>Allow</strong>" Effect as shown in the following screenshot - </p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/MQTT_Connect.png" /></p>
<h3 id="43-create-mqtt_publish-policy">4.3 Create MQTT_Publish Policy:</h3>
<p>Create a new MQTT_Publish policity with "<strong>iot:Publish</strong>" action, "<strong>*</strong>" Resource ARN and "<strong>Allow</strong>" Effect as shown in the following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/MQTT_Publish.png" /></p>
<h3 id="44-create-mqtt_subscribe-policy">4.4 Create MQTT_Subscribe Policy:</h3>
<p>Create a new MQTT_Subscribe policity with "<strong>iot:Subscribe</strong>" action, "<strong>*</strong>" Resource ARN and "<strong>Allow</strong>" Effect as shown in the following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/MQTT_Subscribe.png" /></p>
<h3 id="44-check-the-policies-page">4.4 Check the Policies Page:</h3>
<p>Your <strong>Policies</strong> page should look similar to the following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/new_policies_final.png" /></p>
<h2 id="5-create-and-download-new-certificate">5. Create and Download new Certificate:</h2>
<h3 id="51-create-new-policies">5.1 Create New Policies:</h3>
<p>Click on the "<strong>Create</strong>" button on "<strong>Secure --&gt; Certificates</strong>" page to create a new certificate as shown in the following screenshot -</p>
<p><strong>Note:</strong> If you are creating a Certificate for the first time, you may see a different screen with "<strong>Create a certificate</strong>" button. Just click on that button and follow other steps.</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/new_certificate.png" /></p>
<h3 id="52-create-one-click-certificate">5.2 Create One-Click-Certificate:</h3>
<p>Click on the "<strong>Create certificate</strong>" button to create a new One-click-certificate as shown in the following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/one-click-certificate.png" /></p>
<h3 id="53-download-certificates">5.3 Download Certificates:</h3>
<p>Click on the "<strong>Download</strong>" buttons and download the Certificate file, Public key, and Private key file as shown in the following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/Download_cert.png" /></p>
<h3 id="54-close-the-create-certificate-page">5.4 Close the Create Certificate Page:</h3>
<p>Close the "Create Certificate" page by clicking on the "<strong>Done</strong>" button.</p>
<h3 id="54-download-amazon-root-ca-certificate">5.4 Download Amazon Root CA Certificate:</h3>
<p>Save the "<strong>RSA 2048 bit key: Amazon Root CA 1</strong>" file from the following page as "<strong>AmazonRootCA.crt</strong>" -</p>
<p>(Page URL - <a href="https://docs.aws.amazon.com/iot/latest/developerguide/managing-device-certs.html#server-authentication">https://docs.aws.amazon.com/iot/latest/developerguide/managing-device-certs.html#server-authentication</a>)</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/AWS_Root_CA.png" /></p>
<p>Note: Save all these Certificate and Key files on your machine as you would need to upload them on Raspberry Pi (Appendix-2) and on MQTT_to_DB Agent.</p>
<h3 id="55-check-the-certificates-page">5.5 Check the Certificates Page:</h3>
<p>Now on the "<strong>Secure --&gt; Certificates</strong>" page you should see a new certificate. Note that your certificate is still inactive.</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/certificate_page.png" /></p>
<h2 id="6-activate-the-certificate">6. Activate the Certificate:</h2>
<p>Navigate to "<strong>Secure --&gt; Certificates</strong>"; click on the Certificate options and select "<strong>Activate</strong>" to activate the certificate as shown in following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/activate_certificate.png" /></p>
<h2 id="7-associate-the-policies-with-certificate">7. Associate the Policies with Certificate:</h2>
<p>Navigate to "<strong>Secure --&gt; Certificates</strong>" and click on the certificate to modify the certificate properties. On this certificate properties page click on "<strong>Policies</strong>" and from the "<strong>Actions</strong>" menu select "<strong>Attach Policy</strong>" as shown in the following screenshot - </p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/Attach_Policies.png" /></p>
<p>Select all the policies and click on "<strong>Attach</strong>" button as shown in the following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/select_policies.png" /></p>
<p>Your certificate Policies section should look like this -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/certificate_policies.png" /></p>
<h2 id="8-locate-custom-endpoint">8. Locate Custom Endpoint:</h2>
<p>You would need Custom endpoint to connect to the AWS IoT platform. It will be used by the MQTT clients as MQTT Broker host. You can locate your Customer Endpoint under "Settings" section as shown in the following screenshot -</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/custom_endpoint.png" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../RaPi_with_Sensor/" class="btn btn-neutral" title="Appendix-2 Sensor Setup on Raspberry Pi"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../RaPi_with_Sensor/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
