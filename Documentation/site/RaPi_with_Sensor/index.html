<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Appendix-2 Sensor Setup on Raspberry Pi - Hybrid Cloud IoT App</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Appendix-2 Sensor Setup on Raspberry Pi";
    var mkdocs_page_input_path = "RaPi_with_Sensor.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Hybrid Cloud IoT App</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Lab Access</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../LAB_access/">Accessing the Lab Environment</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cisco Container Platform (CCP)</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../ccp_exploring/">Explore Cisco Container Platform (CCP)</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_create_cluster/">Create Kubernetes Cluster on CCP (Tenant Cluster)</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_accessing_kubernetes_cluster/">Access Kubernetes Cluster (Tenant Cluster)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Hybrid Cloud IoT Application</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../deploy_backend/">Deploy Backend App on Kubernetes Cluster (Tenant Cluster)</a>
                </li>
                <li class="">
                    
    <a class="" href="../backend_exercise/">Explore Backend Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../deploy_frontend/">Deploy Frontend App on Google Kubernetes Engine (GKE)</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_grafana_kibana/">Explore Grafana and Kibana Modules on CCP</a>
                </li>
                <li class="">
                    
    <a class="" href="../ccp_modify_numer_of_nodes/">Kubernetes Exercise</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Kubernetes Network Policies</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../security_policies/">Apply Security Policy to REST API Agent</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Appendices (Optional - Read Only)</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Appendix-2 Sensor Setup on Raspberry Pi</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#appendix-2-raspberry-pi-with-dht22-sensor-and-docker-container">Appendix - 2: Raspberry Pi with DHT22 Sensor and Docker Container</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#1-hardware-and-software-requirements">1. Hardware and Software Requirements:</a></li>
        
            <li><a class="toctree-l4" href="#2-dht22-sensor-connection-with-raspberry-pi">2. DHT22 Sensor Connection with Raspberry Pi</a></li>
        
            <li><a class="toctree-l4" href="#3-burn-raspbian-os-on-the-sd-card-and-enable-ssh">3. Burn Raspbian OS on the SD Card and enable SSH</a></li>
        
            <li><a class="toctree-l4" href="#4-ssh-into-the-raspberry-pi-and-install-docker-runtime">4. SSH into the Raspberry Pi and Install Docker Runtime</a></li>
        
            <li><a class="toctree-l4" href="#5-download-required-files-and-upload-on-raspberry-pi">5. Download Required Files and Upload on Raspberry Pi:</a></li>
        
            <li><a class="toctree-l4" href="#6-test-the-container-on-raspberry-pi">6. Test the Container on Raspberry Pi:</a></li>
        
            <li><a class="toctree-l4" href="#7-configure-raspberry-pi-to-trigger-the-sensor-container-at-startup">7. Configure Raspberry Pi to Trigger the Sensor Container at Startup:</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../AWS_IoT/">Appendix-1 AWS IoT Core Configuration</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Hybrid Cloud IoT App</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Appendices (Optional - Read Only) &raquo;</li>
        
      
    
    <li>Appendix-2 Sensor Setup on Raspberry Pi</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="appendix-2-raspberry-pi-with-dht22-sensor-and-docker-container">Appendix - 2: Raspberry Pi with DHT22 Sensor and Docker Container</h1>
<h2 id="1-hardware-and-software-requirements">1. Hardware and Software Requirements:</h2>
<p>Following are the Hardware and Software prerequisites that you need before you begin with this article - </p>
<h3 id="11-hardware">1.1 Hardware:</h3>
<ul>
<li>Raspberry Pi with Power Adapter</li>
<li>SD Card and SD Card Reader</li>
<li>Ethernet Cable</li>
<li>DHT22 Sensor</li>
<li>10K Ohm Resistor</li>
<li>Jumper wires and Breadboard</li>
<li>Keyboard and Monitor (Optional)</li>
</ul>
<h3 id="12-software">1.2 Software:</h3>
<ul>
<li><a href="https://www.raspberrypi.org/downloads/raspbian/">Official Raspbian Image</a></li>
<li><a href="https://www.balena.io/etcher/">Etcher</a> for flashing Raspbian OS image into theSD card</li>
</ul>
<h2 id="2-dht22-sensor-connection-with-raspberry-pi">2. DHT22 Sensor Connection with Raspberry Pi</h2>
<p>You can connect the DHT22 sensor with Raspberry Pi as shown in the following image. Pin 1 and Pin 4 on the sensor should be connected to the 3.3V Power Pin and Ground Pin respectively. Pin 2 on the sensor should be connected to GPIO Pin 4.</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/Rapi_sensor_connection.png" /></p>
<h2 id="3-burn-raspbian-os-on-the-sd-card-and-enable-ssh">3. Burn Raspbian OS on the SD Card and enable SSH</h2>
<p>Download the <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian</a> OS and use [Etcher] (https://www.balena.io/etcher/) to install it on the SD card. For headless setup, open the SD Card on your computer, after the installation process gets completed to enable SSH.</p>
<p>SSH can be enabled by placing a file named ssh, without any extension, onto the boot partition of the SD card from another computer. When the Pi boots, it looks for the ssh file. If it is found, SSH is enabled and the file is deleted. The content of the file does not matter; it could contain text, or nothing at all.</p>
<p>If you have loaded Raspbian onto a blank SD card, you will have two partitions. The first one, which is the smaller one, is the boot partition. Place the file into this one.</p>
<p>Now plug the SD card into your Raspberry Pi and power it on.</p>
<h2 id="4-ssh-into-the-raspberry-pi-and-install-docker-runtime">4. SSH into the Raspberry Pi and Install Docker Runtime</h2>
<p>SSH into your Raspberry Pi using the following command (replace <ip-address> with the IP Address assigned to your raspberry Pi) -</p>
<pre><code>ssh pi@&lt;ip address&gt;
</code></pre>
<p>On the password prompt you could use the default raspberry password - "<strong>raspberry</strong>"</p>
<p>Now you should have access to the shell. Upgrade raspbian packages using the following command - </p>
<pre><code>sudo apt-get update &amp;&amp; sudo apt-get upgrade
</code></pre>
<p>Install Docker runtime using the following command -</p>
<pre><code>curl -sSL https://get.docker.com | sh
</code></pre>
<p>Add permission to Pi user to run Docker commands by adding “pi” user to “docker” group using the following command –</p>
<pre><code>sudo usermod -aG docker pi
</code></pre>
<p>You must Log off from Raspberry Pi and Login again, for this to take effect.</p>
<p>Check Docker installation using the following command -</p>
<pre><code>docker --version
</code></pre>
<p>If you see the correct version, you are good to go.</p>
<h2 id="5-download-required-files-and-upload-on-raspberry-pi">5. Download Required Files and Upload on Raspberry Pi:</h2>
<p><strong>5.1</strong> Download the Certificate files from from AWS IoT core as described in Appendix - 1</p>
<p><strong>5.2</strong> Download the "<strong>settings.ini</strong>" from github repo - <a href="https://github.com/pradeesi/HybridCloudApp/blob/master/HybridCloudApp/RaspberryPi/settings.ini">Link</a></p>
<p><strong>5.3</strong> Update the settings file variables accordingly.</p>
<p><strong>5.4</strong> Login to Raspberry Pi and create new settings folder under the 'pi' user's home directory, using the following command - </p>
<pre><code>mkdir /home/pi/settings
</code></pre>
<p><strong>5.5</strong> Upload the AWS Certificate Files and updated "settings.ini" file on Raspberry Pi using sftp -</p>
<pre><code>sftp pi@&lt;ip-address&gt;

cd /home/pi/settings

put &lt;file-name&gt;
</code></pre>
<p><strong>Note:</strong> Make sure you copy the updated settings.ini, Amazon RootCA Certificate file, AWS IoT Core Things Certificate &amp; Private Key files into the '/home/pi/settings' directory on your Raspberry Pi.</p>
<p><strong>5.6</strong> Close the sftp session using the following command -</p>
<pre><code>bye
</code></pre>
<h2 id="6-test-the-container-on-raspberry-pi">6. Test the Container on Raspberry Pi:</h2>
<p>Login back into the Raspberry Pi and run the sensor container in an interactive mode using the following command -</p>
<pre><code>sudo docker run --privileged -it -v /home/pi/settings:/usr/src/app/settings pradeesi/rapi_cl_hc_sensor
</code></pre>
<h2 id="7-configure-raspberry-pi-to-trigger-the-sensor-container-at-startup">7. Configure Raspberry Pi to Trigger the Sensor Container at Startup:</h2>
<p><strong>7.1</strong> open the 'rc.local' using the following command -</p>
<pre><code>sudo vi /etc/rc.local
</code></pre>
<p><strong>7.2</strong> Add following command at the top of this file (preferably in the first line) - </p>
<pre><code>sudo docker run --privileged -d -v /home/pi/settings:/usr/src/app/settings pradeesi/rapi_cl_hc_sensor
</code></pre>
<p><strong>7.3</strong> Save the file using '<strong>Esc + :wq</strong>' command on vi editor.</p>
<p><strong>7.4</strong> Change the execution bit using the following command -</p>
<pre><code>sudo chmod +x /etc/rc.local
</code></pre>
<p><strong>7.5</strong> Reboot the Raspberry Pi using '<strong>sudo reboot</strong>'. </p>
<p><strong>7.6</strong> After the reboot process gets completed, login back to the Raspberry Pi and check if the sensor container is running using the command '<strong>sudo docker ps</strong>'.</p>
<p><strong>Note:</strong> If the docker container is not getting triggered on system startup, add 5 second delay by adding '<strong>sleep 5</strong>' before the docker command added in the 'rc.local' file (in Step# 7.2).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../AWS_IoT/" class="btn btn-neutral float-right" title="Appendix-1 AWS IoT Core Configuration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../security_policies/" class="btn btn-neutral" title="Apply Security Policy to REST API Agent"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../security_policies/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../AWS_IoT/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
